<?php
use UserAgentParserComparison\Provider;
use GuzzleHttp\Client;
use GuzzleHttp\HandlerStack;
use GuzzleHttp\Handler\CurlHandler;

/*
 * Browscap
 */
$browscapAdapter = new \League\Flysystem\Local\LocalFilesystemAdapter('data/cache/.tmp/browscap/standard');
$browscapCache   = new \MatthiasMullie\Scrapbook\Psr16\SimpleCache(
    new \MatthiasMullie\Scrapbook\Adapters\Flysystem(
        new \League\Flysystem\Filesystem($browscapAdapter)
    )
);

$logger = new \Psr\Log\NullLogger();

$browscapProviderStandard = new Provider\BrowscapPhp(
    new \BrowscapPHP\Browscap($browscapCache, $logger)
);

/*
 * BrowscapLite
 */
$browscapLiteAdapter = new \League\Flysystem\Local\LocalFilesystemAdapter('data/cache/.tmp/browscap/lite');
$browscapLiteCache   = new \MatthiasMullie\Scrapbook\Psr16\SimpleCache(
    new \MatthiasMullie\Scrapbook\Adapters\Flysystem(
        new \League\Flysystem\Filesystem($browscapLiteAdapter)
    )
);

$browscapProviderLite = new Provider\BrowscapLite(
    new \BrowscapPHP\Browscap($browscapLiteCache, $logger)
);

/*
 * BrowscapFull
 */
$browscapFullAdapter = new \League\Flysystem\Local\LocalFilesystemAdapter('data/cache/.tmp/browscap/full');
$browscapFullCache   = new \MatthiasMullie\Scrapbook\Psr16\SimpleCache(
    new \MatthiasMullie\Scrapbook\Adapters\Flysystem(
        new \League\Flysystem\Filesystem($browscapFullAdapter)
    )
);

$browscapProviderFull = new Provider\BrowscapFull(
    new \BrowscapPHP\Browscap($browscapFullCache, $logger)
);

/*
 * Matomo
 */
$matamoAdapter = new \League\Flysystem\Local\LocalFilesystemAdapter('data/cache/.tmp/matomo');
$matamoCache   = new \MatthiasMullie\Scrapbook\Psr16\SimpleCache(
    new \MatthiasMullie\Scrapbook\Adapters\Flysystem(
        new \League\Flysystem\Filesystem($matamoAdapter)
    )
);

$matomoParser = new \DeviceDetector\DeviceDetector();
$matomoParser->setCache(new \DeviceDetector\Cache\PSR16Bridge($matamoCache));

$matomoProvider = new Provider\MatomoDeviceDetector($matomoParser);

/*
 * BrowserDetector
 */
$detectorAdapter = new \League\Flysystem\Local\LocalFilesystemAdapter('data/cache/.tmp/browser-detector');
$detectorCache   = new \MatthiasMullie\Scrapbook\Psr16\SimpleCache(
    new \MatthiasMullie\Scrapbook\Adapters\Flysystem(
        new \League\Flysystem\Filesystem($detectorAdapter)
    )
);

$browserDetectorFactory  = new \BrowserDetector\DetectorFactory($detectorCache, $logger);
$browserDetectorProvider = new Provider\BrowserDetector(
    $browserDetectorFactory()
);

$whichbrowserAdapter = new \League\Flysystem\Local\LocalFilesystemAdapter('data/cache/.tmp/whichbrowser');
$whichbrowserCache   = new \MatthiasMullie\Scrapbook\Psr6\Pool(
    new \MatthiasMullie\Scrapbook\Adapters\Flysystem(
        new \League\Flysystem\Filesystem($whichbrowserAdapter)
    )
);

return new Provider\Chain([
    $browscapProviderStandard,
    $browscapProviderLite,
    $browscapProviderFull,
    //new Provider\GetBrowser(),
    $matomoProvider,
    $browserDetectorProvider,
    new Provider\DonatjUAParser(),
    new Provider\SinergiBrowserDetector(),
    new Provider\UAParser(),
    new Provider\WhichBrowser($whichbrowserCache),
    new Provider\Woothee(),
    new Provider\Cbschuld(),
    new Provider\Wolfcast(),
    new Provider\Zsxsoft(),
    //new Provider\Endorphin(),
    new Provider\MobileDetect(),
]);
